<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Всі послуги</title>
    <link rel="stylesheet" href="css/main.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>
<style>
    .container {
        display: flex;
        justify-content: space-evenly;
        flex-wrap: wrap;
    }

    .controllers {
        /*display: flex;*/
        /*justify-content: space-evenly;*/
        /*flex-wrap: wrap;*/
    }

    .product {
        width: 31%;
        margin-bottom: 40px;
    }

    .product-image {
        width: 100%;
        /*width: 200px;*/
        height: 300px;
        border-radius: 8px;
    }

</style>

<div id="wrapper">
    <header>
        <ul id="navbar">
            <li><a href="/">Головна</a></li>
            <li><a href="#">Новини</a></li>
            <li><a href="#">Послуги</a>
                <ul>
                    <li><a href="/all-products">Всі послуги</a></li>
                    <li><a href="#">Перукарські послуги</a></li>
                    <li><a href="#">Візаж</a></li>
                    <li><a href="#">Манікюр</a></li>
                </ul>
            </li>
            <li><a href="#">Про нас</a></li>
            <li><a href="/admin">Адміністратор</a></li>
            <li><a href="/login">Увійти</a></li>
        </ul>
    </header>

    <aside>
    </aside>

    <main>
        <div class="controllers">
            <input type="number" id="page" value="1">
            <select id="size">
                <option value="100">100</option>
                <option selected value="10">10</option>
                <option value="5">5</option>
                <option value="2">2</option>
            </select>
            <select id="direction" value="ASC">
                <option value="ASC">А-Я</option>
                <option value="DESC">Я-А</option>
            </select>
            <select id="fieldName" value="categoryName">
                <option value="categoryName">категорія</option>
                <option value="name">назва</option>
            </select>
            <select id="categoriesId" multiple size="3">
                <!--            <option value="categoryName" >вибір катеорії</option>-->
            </select>
            <!--<button id="pagination-confirm">OK</button>-->
        </div>
        <div class="container">
        </div>
    </main>

    <footer>
    </footer>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
    let mainUrl = "http://localhost:8080";
    // let mainUrl = "http://localhost:8000";

    makeRequestProduct();
    makeRequestCategory();

    // $('#pagination-confirm').click(makeRequest);

    $('#page').change(makeRequestProduct);
    $('#size').change(makeRequestProduct);
    $('#direction').change(makeRequestProduct);
    $('#fieldName').change(makeRequestProduct);
    $('#categoriesId').change(makeRequestProduct);

    function makeRequestProduct() {
        let page = $('#page').val() - 1;
        let size = $('#size').val();
        let direction = $('#direction').val();
        let fieldName = $('#fieldName').val();
        let categoriesId = $('#categoriesId').val();
        $.ajax({
            url: mainUrl + "/product/page/filter?direction=" + direction + "&fieldName=" + fieldName + "&page=" + page + "&size=" + size + "&categoriesId=" + categoriesId,
            type: 'GET',
            contentType: 'application/json',
            success: function (res) {
                appendProductsToContainer(res.data)
            },
            error: function (e) {
                console.log(e)
            }
        })
    }
    //
    function appendProductsToContainer(products) {
        let $container = $('.container');
        $container.html('');
        for (let product of products) {
            let img = product.pathToImage ?
                mainUrl + '/img/' + product.pathToImage
                : 'http://denrakaev.com/wp-content/uploads/2015/03/no-image.png';
            $container.append(`
                    <div class="product">
                        <h3 class="product-title">
                            ${product.name}
                        </h3>
                        <img class="product-image" src="${img}">
                        <p class="product-category">Категорія: <strong>${product.categoryName}</strong></p>
                        <p class="product-name">Назва послуги: <strong>${product.name}</strong></p>
                        <p class="product-timeMinutes">Тривалість: <strong>${product.timeMinutes} хв</strong></p>
                        <p class="product-price">Ціна: <strong>₴${product.price}</strong></p>
                    </div>
                `)
        }
    }

    function makeRequestCategory() {
        $.ajax({
            url: mainUrl + "/category/page?direction=ASC&fieldName=name&page=0&size=100",
            type: 'GET',
            contentType: 'application/json',
            success: function (res) {
                appendCategoriesToContainer(res.data)
            },
            error: function (e) {
                console.log(e)
            }
        })
    }
    //
    function appendCategoriesToContainer(categories) {
        let $container = $('#categoriesId');
        $container.html('');
        for (let category of categories) {
            $container.append(`
                    <option value="${category.id}" selected>${category.name}</option>
                `)
        }
    }

    // function getPaginationRequest() {
    //     return {
    //         page: $('#page').val() - 1,
    //         size: $('#size').val(),
    //         sortRequest: {
    //             field: 'name',
    //             direction: $('#direction').val()
    //         }
    //     };
    // }

</script>
</body>
</html>